<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    {{block 'title'}}{{/block}}
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" href="/css/user.css">
    <link rel="stylesheet" href="/editor.md/css/editormd.min.css">
    <link rel="shortcut icon" href="/img/logo1.png" type="image/x-icon">
</head>
<body>
    <div class="layout-wrap">
        <div class="left">
            <div class="userinfo">
                <img class="uimg" src="/img/user.gif" alt="">
                <div class="uname">我真的好菜</div>
                <div class="motto">一个不专注前端的前端程序猿</div>
            </div>
            <div class="category">
                <ul>
                    <li><a href="/">
                        <svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-index"></use>
                        </svg>首页</a>
                    </li>
                    <li><a href="/brief">
                        <svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-brief"></use>
                        </svg>文章简史</a>
                    </li>
                    <li><a href="/tags">
                        <svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-tag"></use>
                        </svg>文章标签</a>
                    </li>
                    <!-- <li><a href="/editor">
                        <svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-write"></use>
                        </svg>写文章</a>
                    </li> -->
                    <li><a href="/about">
                        <svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-about"></use>
                        </svg>联系我</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="right">
            <div class="content">
                {{block 'content'}}{{/block}}
                <div class="content-bottom">
                        ©2018 -  huangss - 一个不专注前端的前端程序猿 - Powered by Koa2 & art-template
                </div>
            </div>
            <div class="toolBox">
                <div class="search">
                    <input type="text" name="search" id="search" placeholder="关键字">
                    <ul class="result">
                    </ul>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="/js/iconfont.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-2.1.4.min.js"></script>
<script>
    $(() =>{
        //查询用户信息 admin
        $.ajax({
            url: '/getUserInfo',
            success(res){
                $('.uimg').attr('src', res.user.picture);
                $('.uname').text(res.user.nname);
                $('.motto').text(res.user.motto);
            }
        })
        //根据关键字查询文章
        $("#search").on('keyup', debounce(search, 500));
    })

    //查询文章
    function search(){
        let search = $('#search').val();
        if(search === ''){
            $('.result li').remove();
        }else{
            $.ajax({
                url: 'searchArtcleByTag',
                data:{
                    search
                },
                dataType: 'json',
                success(res){
                    let data = res.blogs;
                    if(data.length === 0){
                        $('.result').html('<li style="text-align:center">无结果</li>');
                    }else{
                        let html = '';
                        data.forEach(blog =>{
                            html += `<li><a href="/preview?_id=${blog._id}">${blog.title}</a></li>`;
                        })
                        $('.result').html(html);
                    }
                }
            })
        }
    }
    /*
        函数防抖 在规定的时间内，只执行一次调用，如果在时间范围内有新的输入，重新计时
    */
    function debounce(method, delay) {
        //定时器  子函数执行完，仍然存在
        let timer = null;
        return function () {
            let context = this, 
                args = arguments;

            clearTimeout(timer);
            timer = setTimeout(function () {
                //执行函数
                method.apply(context, args);
            }, delay);
        }
    }
</script>
{{block 'js'}}{{/block}}
</html>