<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    {{block 'title'}}{{/block}}
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" href="/css/user.css">
    <link rel="stylesheet" href="/editor.md/css/editormd.min.css">
    <link rel="shortcut icon" href="/img/logo1.png" type="image/x-icon">
</head>
<body>
    <div class="layout-wrap">
        <div class="left">
            <div class="colorDiv"></div>
            <img class="uimg" src="{{user.picture}}">
            <div class="userinfo">
                <div class="uname">{{user.nname}}</div>
                <div class="motto">{{user.motto}}</div>
            </div>
            <div class="category">
                <ul>
                    <li><a href="/">
                        <svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-index"></use>
                        </svg>首页</a>
                    </li>
                    <li><a href="/brief">
                        <svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-brief"></use>
                        </svg>文章简史</a>
                    </li>
                    <li><a href="/tags">
                        <svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-tag"></use>
                        </svg>文章标签</a>
                    </li>
                    <li><a href="/about">
                        <svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-about"></use>
                        </svg>联系我</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="right">
            <div class="content">
                {{block 'content'}}{{/block}}
                <div class="content-bottom">
                        ©2018 -  huangss - 一个不专注前端的前端程序猿 - Powered by Koa2 & art-template
                </div>
            </div>
            <div class="toolBox">
                <div class="fixedWrap">
                    <div class="search">
                        <input type="text" name="search" id="search" placeholder="文章标签">
                        <svg class="icon" aria-hidden="true" style="position:absolute;top:8px;right:12px">
                            <use xlink:href="#icon-search"></use>
                        </svg>
                        <ul class="result"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="/js/iconfont.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-2.1.4.min.js"></script>
<script>
    $(() =>{
        //根据关键字查询文章
        $("#search").on('keyup', debounce(search, 500));

        //监听屏幕的滚动
        $('.right').scroll(function(){
            //随着屏幕滚动的对象
            let scrolled = $('.fixedWrap');
            //计算滚动的距离
            let scrollDistance = $(this).scrollTop() + 'px';

            scrolled.css('top',  scrollDistance);
        });
    })

    //查询文章
    function search(){
        let search = $('#search').val();
        if(search === ''){
            $('.result li').remove();
        }else{
            $.ajax({
                url: 'searchArtcleByTag',
                data:{
                    search
                },
                dataType: 'json',
                success(res){
                    let data = res.blogs;
                    if(data.length === 0){
                        $('.result').html('<li style="text-align:center">无结果</li>');
                    }else{
                        let html = '';
                        data.forEach(blog =>{
                            html += `<li><a href="/preview?_id=${blog._id}">${blog.title}</a></li>`;
                        })
                        $('.result').html(html);
                    }
                }
            })
        }
    }
    
    //函数防抖 在规定的时间内，只执行一次调用，如果在时间范围内有新的输入，重新计时
    function debounce(fn, delay) {
        //定时器  子函数执行完，仍然存在
        let timer = null;
        return function () {
            let that = this;
            let args = arguments;

            clearTimeout(timer);
            timer = setTimeout(function () {
                //执行函数
                fn.apply(that, args);
            }, delay);
        }
    }
    
    //函数节流
    function throttle(fn, delay = 1000){
        let endTime = null;

        return function(){
            let startTime = new Date();
            let that = this;

            //如果时间差大于等待时间 || 第一次执行
            if (startTime - endTime > delay) {
                //执行函数
                fn.apply(that, arguments);
                //记录上次执行的事件
                endTime = startTime
            }
        }
    }
</script>
{{block 'js'}}{{/block}}
</html>